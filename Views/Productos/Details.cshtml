@model Pg1.Models.Producto

@{
    ViewData["Title"] = "Detalle del Producto";

    string imageUrl;
    if (!string.IsNullOrEmpty(Model.ImagenUrl))
    {
        if (Model.ImagenUrl.StartsWith("http://") || Model.ImagenUrl.StartsWith("https://"))
        {
            imageUrl = Model.ImagenUrl;
        }
        else
        {
            imageUrl = Url.Content("~/img/" + Model.ImagenUrl.TrimStart('/'));
        }
    }
    else
    {
        imageUrl = Url.Content("~/img/placeholder.jpg"); // Imagen por defecto si no hay
    }
}

<h2>@Model.Nombre</h2>

<div class="row">
    <div class="col-md-6">
        <img src="@imageUrl" alt="@Model.Nombre" class="img-fluid rounded shadow-sm" />
    </div>

    <div class="col-md-6">
        <dl class="row">
            <dt class="col-sm-4">Descripción</dt>
            <dd class="col-sm-8">@Model.Descripcion</dd>

            <dt class="col-sm-4">Categoría</dt>
            <dd class="col-sm-8">@Model.Categoria?.Nombre</dd>

            <dt class="col-sm-4">Precio</dt>
            <dd class="col-sm-8 fw-bold">@Model.Precio.ToString("C")</dd>

            <dt class="col-sm-4">Stock</dt>
            <dd class="col-sm-8">
                @if (Model.Stock > 0)
                {
                    <span class="badge bg-success">Disponible (@Model.Stock)</span>
                }
                else
                {
                    <span class="badge bg-danger">Sin stock disponible</span>
                }
            </dd>
        </dl>

        <div class="mt-4">
            @if (Model.Stock > 0)
            {
                <form asp-controller="Carrito" asp-action="AgregarAlCarrito" method="post" role="form">
                    @Html.AntiForgeryToken()
                    <input type="hidden" name="idProducto" value="@Model.IdProducto" />
                    <button type="submit" class="btn btn-success" aria-label="Añadir @Model.Nombre al carrito">Añadir al carrito</button>
                </form>
            }
            else
            {
                <button class="btn btn-danger" disabled aria-disabled="true">Sin stock</button>
            }
        </div>

        <a asp-action="Index" class="btn btn-outline-secondary mt-3">Volver al catálogo</a>
    </div>
</div>
